---
title: 应用配置
author: ALRCMt
date: 2025-06-10
category: Jekyll
layout: post
---

> 小提示：  
> 在 Linux 系统中 Ctrl + Shift + C 复制； Ctrl + Shift + V: 粘贴  
> 在 vi/vim 编辑器中，`:wq`是保存并退出，`:q!`是不保存退出  
> 在 nano 编辑器中 Ctrl + W 快捷键是查找文本，但是与 web 界面关闭页面冲突，所以可以用 Ctrl + Q 代替，Ctrl + X 是退出，会询问是否保存
> sudo 不能提升 cd 的权限

<hr />

## PVE 配置

### 1.设置 PVE 的 APT 源

**8.x 版本设置**
PVE 的默认软件源是他的企业服务地址，我们个人使用需要将其换成国内的软件源
编辑`/etc/apt/sources.list`，替换如下

```shell
deb https://mirrors.ustc.edu.cn/debian bookworm main contrib
deb https://mirrors.ustc.edu.cn/debian bookworm-updates main contrib
deb https://mirrors.ustc.edu.cn/debian-security bookworm-security main contrib
```

将 PVE 的企业源 `/etc/apt/sources.list.d/pve-enterprise.sources` 注释掉  
将 PVE 的 Ceph 源`/etc/apt/sources.list.d/ceph.list`，替换如下

```shell
deb https://mirrors.tuna.tsinghua.edu.cn/proxmox/debian/ceph-quincy bookworm no-subscription
```

在`/etc/apt/sources.list.d/`下创建 pve-no-sub.list 文件，填上以下内容

```shell
deb https://mirrors.tuna.tsinghua.edu.cn/proxmox/debian bookworm pve-no-subscription
```

**9.x 版本设置**
在`/etc/apt/sources.list.d/debian.sources `中注释掉原有配置，添加以下

```shell
Types: deb
URIs: https://mirrors.tuna.tsinghua.edu.cn/debian
Suites: trixie trixie-updates trixie-backports
Components: main contrib non-free non-free-firmware
Signed-By: /usr/share/keyrings/debian-archive-keyring.gpg

Types: deb-src
URIs: https://mirrors.tuna.tsinghua.edu.cn/debian
Suites: trixie trixie-updates trixie-backports
Components: main contrib non-free non-free-firmware
Signed-By: /usr/share/keyrings/debian-archive-keyring.gpg
```

> 因为 9.x 版本 BUG 太多了，这下面的源换不换随便，我也不清楚

> 将 PVE 的企业源 `/etc/apt/sources.list.d/pve-enterprise.sources` 注释掉  
> 将 PVE 的 Ceph 源 `/etc/apt/sources.list.d/ceph.sources` 也替换成清华源

```shell
Types: deb
URIs: https://mirrors.tuna.tsinghua.edu.cn/proxmox/debian/ceph-squid
Suites: trixie
Components: main
Signed-By: /usr/share/keyrings/proxmox-archive-keyring.gpg
```

> 在 `/etc/apt/sources.list.d` 目录下创建 pve-no-subscription.sources 文件，填上以下内容

```shell
Types: deb
URIs: https://mirrors.tuna.tsinghua.edu.cn/proxmox/debian/pve
Suites: trixie
Components: pve-no-subscription
Signed-By: /usr/share/keyrings/proxmox-archive-keyring.gpg
```

> 如果修改 apt 源后报错，[解决方法](/jekyll/2025-06-11-LoveFormMe.html#06pve-%E6%9B%B4%E6%8D%A2-apt-%E6%BA%90%E5%90%8E%E6%8A%A5%E9%94%99)

### 2.网络唤醒 WOL

需要在 BIOS 中开启 WOL 功能，各主板设置方法不同，自己上网查去  
默认情况下，PVE 的网络唤醒是禁用的，需要手动打开才可以网络唤醒

安装 ethtool 工具

```shell
apt install ethtool
```

查看网卡信息

```shell

ethtool [网卡名称] # 观察输出结果Supports Wake-on 与 Wake-on

# supports wake-on 判断该网卡是否支持 WOL 唤醒，若值为 pumbg 则表示支持 WOL
# Wake-on 值为 d 则表示 WOL 禁用状态，g 则为开启，PVE 默认为 d
```

开启 WOL 网络唤醒

```shell
ethtool -s eth0 wol g
```

由于每次开机时，Wake-on 的值都会重置为 d，因此需要在开机时自动运行开启 WOL 的命令

编辑 /etc/rc.local 文件

```shell
#!/bin/bash
ethtool -s eth0 wol g
​
exit 0
```

赋予运行权限

```shell
chmod +x /etc/rc.local
```

目前我用的是蒲公英自带的**向日葵远程开机**

> 冷知识：蒲公英重启后，服务器第一次无开机法远程唤醒
 
### 3.自动开关机
自动开机：在主板BIOS设置唤醒事件管理，选择时间，我选择每天9点

自动关机： 
编辑 root 用户的 crontab
``` shell
crontab -e
```
添加自动关机任务
``` shell
# 每天凌晨2:30执行关机
30 2 * * * /sbin/shutdown -h +5 "系统将在5分钟后关机进行日常维护，请保存您的工作"
```
<hr />

## 旁路由 R300A 配置

### 1.开启路由器的 WAN 口转发

打开贝锐蒲公英后台：[https://www.pgybox.com/zh/intelligentNetwork/forwardingSettings](https://www.pgybox.com/zh/intelligentNetwork/forwardingSettings)  
找到转发设置，打开 WAN 口入站路由转发

### 2.配置异地组网

打开蒲公英管理平台：[https://console.sdwan.oray.com/zh/main](https://console.sdwan.oray.com/zh/main)
创建网络，添加硬件成员 R300A  
添加网络成员，然后在需要连接的设备上下载贝锐蒲公英客户端，登录添加的网络成员账号，即可开启组网

<img src="https://github.com/ALRCMt/MtAIO-Build/raw/main/photo/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-09%20150111.png" alt="" width="700px"/>

贝锐蒲公英客户端下载：[https://pgy.oray.com/download#visitor](https://pgy.oray.com/download#visitor)

<hr />

## TrueNAS 配置

### 1.实现硬盘直通

教程地址：[pve 硬盘直通](https://github.com/firemakergk/aquar-build-helper/blob/master/details/pve%E7%A1%AC%E7%9B%98%E7%9B%B4%E9%80%9A.md)

> 取消硬盘直通的方法  
> pve 的 web 界面选择虚拟机的“硬件”，选择指定硬盘，点击“分离”

### 2.配置存储池及用户设置

教程：  
[【司波图】TrueNAS SCALE 教程，第一章——简单用起来](https://www.bilibili.com/video/BV1cK411z7dx/?spm_id_from=333.1007.top_right_bar_window_custom_collection.content.click&vd_source=2a55d6df129012c2f31dfcad634bc9de)

### 3.SMB 共享配置

在 TrueNAS 的 Web 页面上进入共享页面  
打开 Windows（SMB）共享服务  
_确认在用户配置创建的用户勾选了 SMB 用户选项_
添加 SMB 共享，选择共享目录

<img src="https://github.com/ALRCMt/MtAIO-Build/raw/main/photo/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-10%20133538.png" alt="" width="700px"/>

在同一个局域网中，在文件管理器显示各个硬盘页面的空白处右键，选择“添加一个网络位置”

<img src="https://github.com/ALRCMt/MtAIO-Build/raw/main/photo/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-10%20133618.png" alt="" width="700px"/>

一番下一步后会让你输入地址，填写 truenas 的服务地址然后又是一番下一步，最后会询问你用户名和密码  
这时候就填写你在 TrueNas 上新创建的用户的名称和密码即可

<img src="https://github.com/ALRCMt/MtAIO-Build/raw/main/photo/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-10%20134332.png" alt="" width="400px"/>

<img src="https://github.com/ALRCMt/MtAIO-Build/raw/main/photo/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-10%20134349.png" alt="" width="300px"/>

- 小提示：地址从你的存储池开始计算，如我这里就是/Mt 而不是 /mnt/MtData/Mt

最终结果：

<img src="https://github.com/ALRCMt/MtAIO-Build/raw/main/photo/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-10%20134441.png" alt="" width="300px"/>

### 4.NFS 共享配置

> _注意！！！_  
> _这里请配合 Ubuntu 挂载使用_

同上，打开 UNIX（NFS）共享服务  
添加 NFS 共享，选择共享目录  
如果想方便一点，选择配置服务，勾选允许非 root 挂载  
之后操作在 Ubuntu 系统完成

<hr />

## Ubuntu 配置

### 1.安装 Docker ~~_最折磨人的一集_~~(其实还好)

~~由于国内网络问题（最折磨），Docker 使用阿里云镜像源安装~~  
目前 Docker 安装的网络问题得到了改善

在 ubuntu 控制台输入以下命令  
_粘贴板不互通无法复制？请用 ssh 连接。无法 ssh？[可能解决方案](/jekyll/2025-06-11-LoveFormMe.html#03ssh-%E5%8A%9F%E8%83%BD%E5%BC%80%E5%90%AF%E9%97%AE%E9%A2%98)_

```shell

# 在安装 Docker 之前，我们需要安装一些必要的依赖包。运行以下命令：
sudo apt install apt-transport-https ca-certificates curl software-properties-common

apt install -y docker.io  docker-compose # 安装docker
docker version # 验证安装

```

现在 Docker 已经安装完毕，但是拉取镜像的网络环境依旧~~十分~~很他妈糟糕，所以先不拉取 hello-world 测试，等会教学配置加速地址

### 2.安装 Docker 可视化工具 DPanel

DPanel 是一款**支持中文**的 Docker 可视化插件  
使用如下命令下载 Dpanel lite 版镜像  
官方教程：[https://dpanel.cc/install/docker](https://dpanel.cc/install/docker)

```shell
docker pull registry.cn-hangzhou.aliyuncs.com/dpanel/dpanel:lite
```

之后使用如下命令运行 Dpanel 容器

```shell
docker run -d --name dpanel --restart=always \
 -p 80:80 -p 443:443 -p 8807:8080 -e APP_NAME=dpanel \
 -v /var/run/docker.sock:/var/run/docker.sock \
 -v /home/dpanel:/dpanel registry.cn-hangzhou.aliyuncs.com/dpanel/dpanel:lite
```

DPanel 管理地址：Ubuntu 网络地址加端口 8807
快速使用教程：[一款更适合国人的 Docker 可视化管理工具](https://www.bilibili.com/video/BV1gDc9eaEBv/?spm_id_from=333.337.search-card.all.click&vd_source=2a55d6df129012c2f31dfcad634bc9de)

### 3.Docker 镜像仓库加速

**命令行加速**

编辑`/etc/docker/daemon.json`，加入以下内容

```shell
{
  "registry-mirrors": [
    "https://docker.1ms.run",
    "https://docker.m.daocloud.io",
    "https://registry.cn-hangzhou.aliyuncs.com"
  ],
}
```

保存并退出

**面板加速**

在 DPanel 内选择**仓库管理**，编辑 Docker Hub 仓库  
添加加速地址，下面有推荐加速地址  
<img src="https://github.com/ALRCMt/MtAIO-Build/raw/main/photo/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-10%20151557.png" alt="" width="700px"/>

如果你要加速别的仓库，请**添加仓库**，然后配置加速，[可添加仓库](https://dpanel.cc/manual/image-registry)

### 4.数据卷的创建、挂载、查看、删除

挂载数据卷可能比较好操作  
如果你偏爱用命令行操作，那么如下

```shell
docker volume create my-vol # 创建一个数据卷

docker volume ls # 查看所有的数据卷

docker volume inspect my-vol # 查看指定数据卷的信息

docker volume rm my-vol # 删除数据卷
```

将数据卷挂载在容器的固定目录

```shell
docker run -it -v [数据卷名字]:[容器目录] [镜像名称]
```

如果你想用图形化操作，如下
打开 DPanel 的 web 页面，选择储存管理

<img src="https://github.com/ALRCMt/MtAIO-Build/raw/main/photo/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-10%20145725.png" alt="" width="700px"/>

然后创建储存卷，名称随便，其它默认，然后确定

<img src="https://github.com/ALRCMt/MtAIO-Build/raw/main/photo/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-10%20145806.png" alt="" width="300px"/>

### 5.将 TrueNAS 存储池挂载到指定目录

> _注意！！！ 配合[NFS 共享配置](/jekyll/2025-06-10-Apply.html#4nfs-%E5%85%B1%E4%BA%AB%E9%85%8D%E7%BD%AE)、[数据卷的创建挂载](/jekyll/2025-06-10-Apply.html#4%E6%95%B0%E6%8D%AE%E5%8D%B7%E7%9A%84%E5%88%9B%E5%BB%BA%E6%8C%82%E8%BD%BD%E6%9F%A5%E7%9C%8B%E5%88%A0%E9%99%A4)使用，将存储池挂到数据卷的挂载点_

```shell
sudo apt update # 更新系统存储库索引
sudo apt install nfs-common # 安装 NFS 客户端包

sudo mount [NFS _IP]:/[NFS_export] [Local_mountpoint] # 将NFS服务器共享目录挂载到客户端的挂载点目录

# NFS_IP 是 NFS 服务器的 IP 地址
# NFS_export 是 NFS 服务器上的共享目录
# Local_mountpoint 是客户端系统上的挂载点目录

mount | grep nfs # 查看已挂载的NFS共享目录，确认挂载成功

sudo nano /etc/fstab # 设置 NFS 文件在系统启动时自动挂载

# 然后使用以下格式在 /etc/fstab 文件中添加条目

[NFS _IP]:[NFS_export] [Local_mountpoint] nfs defaults 0 0   # NFS 服务器:服务器共享目录 目录挂载点 nfs 默认 0 0

# 然后保存并退出
```

卸载 NFS 挂载

```shell
umount [mount_point] # [mount_point]是挂载目录

# 如果该目录正在被使用或者已经被其他进程打开，你可能会收到一个错误消息。在这种情况下，可以尝试使用以下命令强制取消挂载

umount -f [mount_point]

mount | grep nfs # 最后，检查挂载是否成功取消
```

### 6.Docker 部署 Resilio Sync

通过 DPanel 图形化操作，打开容器列表，创建容器，然后拉取镜像，镜像地址`resilio/sync:latest`

<img src="https://github.com/ALRCMt/MtAIO-Build/raw/main/photo/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-10%20151320.png" alt="" width="600px"/>
<img src="https://github.com/ALRCMt/MtAIO-Build/raw/main/photo/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-10%20152541.png" alt="" width="600px"/>   
等待镜像拉取完成，大部分设置已经设置好了
只需要绑定端口，如图  
<img src="https://github.com/ALRCMt/MtAIO-Build/raw/main/photo/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-10%20152732.png" alt="" width="500px"/>

然后挂载数据卷，选择添加映射目录  
左侧填你创建的数据卷名称，右侧填容器内目录，目录最好是/mnt/sync/folders/\*，不然可能会没权限

<img src="https://github.com/ALRCMt/MtAIO-Build/raw/main/photo/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-10%20152741.png" alt="" width="500px"/>

在运行配置页面，重启策略选择**未手动停止则重启**  
最后选择**提交**，容器就创建并运行了

Resilio Sync 管理地址：Ubuntu 网络地址加端口 8888  
使用教程（更多还是自己摸索吧）：[https://zhuanlan.zhihu.com/p/745919095](https://zhuanlan.zhihu.com/p/745919095)

### 7.Docker 部署 immich
通过 Dpanel 图形化操作，使用Docker Compose部署 

<img src="https://github.com/ALRCMt/MtAIO-Build/raw/main/photo/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-16%20145611.png" alt="" width="650px"/>

选择Compose，**创建任务**，名称随便  
下载yaml文件和env文件导入：[https://immich.app/docs/install/docker-compose](https://immich.app/docs/install/docker-compose)  

> 因为我要用immich管理相机备份，文件在link.nas数据卷，所以编辑yaml  
> 修改如下内容，将宿主机路径 /var/lib/docker/volumes/link.nas/_data 挂载到容器内的 /mnt/nas 

``` shell
services:
  immich-server:
    volumes:
      - ./immich-data:/usr/src/app/upload  # 保留原始卷
      - /var/lib/docker/volumes/link.nas/_data:/mnt/nas  # 新增挂载点
    # 其他配置保持不变...

  immich-microservices:
    volumes:
      - ./immich-data:/usr/src/app/upload  # 保留原始卷
      - /var/lib/docker/volumes/link.nas/_data:/mnt/nas  # 新增挂载点
    # 其他配置保持不变...
```

填写环境变量   
`UPLOAD_LOCATION`：图片存储位置  
`DB_DATA_LOCATION`：数据库文件存储位置  
`# TZ`：时区

这是我填的  
<img src="https://github.com/ALRCMt/MtAIO-Build/raw/main/photo/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-16%20150025.png" alt="" width="380px"/>  
<img src="https://github.com/ALRCMt/MtAIO-Build/raw/main/photo/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-16%20152101.png" alt="" width="200px"/>  
然后**提交**，点击详情，选择**启动**  
<img src="https://github.com/ALRCMt/MtAIO-Build/raw/main/photo/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-16%20153548.png" alt="" width="350px"/>

等待镜像拉取完成，如果出现`运行中(4)`就好了  
<img src="https://raw.githubusercontent.com/ALRCMt/MtAIO-Build/cb99109050678a8dc9f7933bb70bc5681e4f1084/photo/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-16%20154355.png" alt="" width="700px"/>  
管理地址：Ubuntu 网络地址加端口 2283  
管理我的相机备份：添加外部图库，选择路径是之前映射到容器内的路径  
然后扫描，等待，完成，其他教程自己网上搜去  
官方文档：[https://immich.app/docs/overview/welcome](https://immich.app/docs/overview/welcome)   

> 一定要使四个容器都拉取完成，可能有点慢  
> 如果出现报错`error response from daemon: get "https://ghcr.io/v2/": not found`  
> 那就是网络问题，如果你已经配置了加速  
> 那么，似乎没有更好的办法，**祈祷**吧

<img src="https://raw.githubusercontent.com/ALRCMt/MtAIO-Build/cb99109050678a8dc9f7933bb70bc5681e4f1084/photo/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-16%20161707.png" alt="" width="200px"/>
> 小贴士：上半夜Docker Hub的网络很差

### 8.Docker 部署 V2rayA

**请确保你有可用稳定的代理地址**

选择**Compose**，创建任务，yaml如下

``` shell
version: '3.8' 
services:
  v2raya:
    image: mzz2017/v2raya
    restart: always
    container_name: v2raya
    network_mode: host 
    privileged: true 
    cap_add:    
      - NET_ADMIN
      - SYS_MODULE
    ports:
      - "2017:2017"
      - "7890:7890"
    volumes:
      - ./etc:/etc/v2raya
```
**提交**，**启动**，等待镜像拉取完成  
浏览器访问地址 http://ip:2017  
打开v2rayA，创建管理员账号  
以创建或导入的方式导入节点，导入支持节点链接、订阅链接  

点击右上角的设置，开启ip转发和端开分享，根据自己的需求设置  
<img src="https://raw.githubusercontent.com/ALRCMt/MtAIO-Build/cb99109050678a8dc9f7933bb70bc5681e4f1084/photo/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-17%20232009.png" alt="" width="450px"/>

然后回到首页，选择一个节点点击连接后，在点击左上角的启动按钮启动即可  
<img src="https://raw.githubusercontent.com/ALRCMt/MtAIO-Build/cb99109050678a8dc9f7933bb70bc5681e4f1084/photo/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-17%20231749.png" alt="" width="750px"/>

### 9.配置代理

安装proxychains工具  
``` shell
sudo apt update 
sudo apt install proxychains
```
编辑 `/etc/proxychains.conf`  
在 /etc/proxychains.conf 增加socks5，同时注释掉socks4的内容：
``` shell
# socks4 127.0.0.1 9050
socks5 [部署v2raya的服务器ip] 端口号
```
例如我在 IP 为 10.168.1.165 的服务器上，部署了v2rayA，同时开启了端口分享  
并且查看到了socks5的端口号是20170，那么就将proxychains的配置文件改为：    
``` shell
# socks4 127.0.0.1 9050
socks5 10.168.1.165 20170 # 如果是本机使用，ip可改为127.0.0.1
```
访问谷歌测试是否成功  
``` shell
proxychains curl https://www.google.com
```
出现以下内容就算成功  
<img src="https://raw.githubusercontent.com/ALRCMt/MtAIO-Build/cb99109050678a8dc9f7933bb70bc5681e4f1084/photo/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-17%20234722.png" alt="" width="550px"/>
<br />

### 10.Docker部署qBittorrent WebUI
通过Docker Compose部署

编辑yaml文件
 ``` shell
version: "3"
services:
  qbittorrent:
    image: linuxserver/qbittorrent
    container_name: qbittorrent
    environment:
      - PUID=0
      - PGID=0
      - TZ=Asia/Shanghai 
      - UMASK_SET=022
      - WEBUI_PORT=8085  # Web UI端口
      - TORRENTING_PORT=26881 # 监听端口，默认6881，修改为20000-65535区间值，下同
    volumes:
      - /vol1/1000/docker/qbittorrent/config:/config  # 冒号左侧修改参照上文
      - /vol2/1000/Download2:/downloads2
      - /vol3/1000/Download3:/downloads3          #同上
    ports:
      - 8085:8085  # 同上面Web UI端口一致
      - 26881:26881
      - 26881:26881/udp
    restart: unless-stopped
```
**提交**，**启动**
管理界面：http://ip:8085
用户admin，临时密码可以在日志中看见
> 小提示  
> 如果遇到管理界面打不开或显示**unauthorized**
> 请想办法换一个内核的浏览器（自己想办法）  
> 登录后在设置>WebUI中去掉 _启用跨站请求伪造 (CSRF) 保护_ 然后保存

怎么用自己搜去

### 11.Docker部署OpenList 
OpenList是Alist的社区版本，这里选择OpenList

创建容器，拉取`openlistteam/openlist:latest`，绑定端口，把要用的文件夹挂好  
然后 http://ip:5244 ，登录  
官方文档：[https://openlistteam.github.io/docs/zh/](https://openlistteam.github.io/docs/zh)
使用教程网上一大把

### 12.Docker部署Aria2 webUI
发现有些功能qB还是没有Aria2方便，选择了Aria2的WebUI版本  
官方链接：[https://github.com/mayswind/AriaNg](https://github.com/mayswind/AriaNg)

怎么部署的我忘了，等会